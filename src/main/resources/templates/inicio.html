<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Simple - Inicio</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <style>
        :root {
            --pastel-blue: #a8d8ea;
            --pastel-green: #b8e0d2;
            --pastel-pink: #ffd6e7;
            --pastel-purple: #d9c5f4;
            --pastel-yellow: #fff9c4;
            --pastel-lavender: #e6e6fa;
        }
        
        body {
            background: linear-gradient(135deg, var(--pastel-lavender), var(--pastel-blue));
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            padding-top: 76px;
        }
        
        .navbar-pastel {
            background-color: var(--pastel-blue) !important;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .nav-link {
            color: #5a5a5a !important;
            font-weight: 500;
            padding: 8px 15px !important;
            border-radius: 20px;
            transition: all 0.3s;
        }
        
        .nav-link:hover {
            background-color: var(--pastel-purple) !important;
            color: #333 !important;
        }
        
        .nav-link.active {
            background-color: var(--pastel-pink) !important;
            color: #333 !important;
        }
        
        .btn-pastel-primary {
            background-color: var(--pastel-pink);
            border: none;
            color: #333;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        
        .btn-pastel-primary:hover {
            background-color: var(--pastel-purple);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .btn-pastel-success {
            background-color: var(--pastel-green);
            border: none;
            color: #333;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        
        .btn-pastel-success:hover {
            background-color: #a3d5c3;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .btn-pastel-info {
            background-color: var(--pastel-blue);
            border: none;
            color: #333;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        
        .btn-pastel-info:hover {
            background-color: #97c9e0;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .hola-mundo {
            font-size: 3.5rem;
            font-weight: 300;
            letter-spacing: 2px;
            background: linear-gradient(45deg, #ff9a9e, #fad0c4, #a8d8ea, #b8e0d2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 300% 300%;
            animation: gradient 5s ease infinite;
        }
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .hero-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .form-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border: 2px solid var(--pastel-green);
            margin-bottom: 30px;
        }
        
        .input-pastel {
            border: 2px solid var(--pastel-blue);
            border-radius: 10px;
            padding: 12px 15px;
            transition: all 0.3s;
            font-size: 1.1rem;
        }
        
        .input-pastel:focus {
            border-color: var(--pastel-purple);
            box-shadow: 0 0 0 3px rgba(217, 197, 244, 0.3);
            outline: none;
        }
        
        .feature-icon {
            font-size: 3rem;
            color: var(--pastel-purple);
        }
        
        .demo-info {
            background-color: var(--pastel-yellow);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid var(--pastel-purple);
        }
        
        .bd-info {
            background: linear-gradient(135deg, var(--pastel-blue), var(--pastel-purple));
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .counter-badge {
            background-color: rgba(255, 255, 255, 0.9);
            color: #333;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-block;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <!-- Barra de Navegación Superior -->
    <nav class="navbar navbar-expand-lg navbar-pastel fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="bi bi-house-heart"></i> Sistema Simple
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="/">
                            <i class="bi bi-house"></i> Inicio
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/principal">
                            <i class="bi bi-people"></i> Personas (Memoria)
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/ver-registros-h2">
                            <i class="bi bi-database"></i> Registros H2
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/registrar">
                            <i class="bi bi-person-plus"></i> Registrar
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/acerca">
                            <i class="bi bi-info-circle"></i> Acerca de
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="hero-card">
                    <!-- Hola Mundo -->
                    <h1 class="hola-mundo mb-4 text-center" th:text="${mensaje}">¡Hola Mundo!</h1>
                    
                    <p class="lead text-muted mb-4 text-center">
                        Sistema simple con Spring Boot MVC y Base de Datos H2
                    </p>
                    
                    <!-- Mensajes -->
                    <div th:if="${param.exito}" class="alert alert-success alert-dismissible fade show mb-4">
                        <i class="bi bi-check-circle"></i>
                        <span th:text="${param.exito}"></span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                    
                    <div th:if="${param.error}" class="alert alert-danger alert-dismissible fade show mb-4">
                        <i class="bi bi-exclamation-triangle"></i>
                        <span th:text="${param.error}"></span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                    
                    <!-- FORMULARIO PARA INSERTAR EN H2 CON TECLADO -->
                    <div class="form-card">
                        <h3 class="text-center mb-4" style="color: var(--pastel-purple);">
                            <i class="bi bi-keyboard"></i> Insertar Registro en H2 Database
                        </h3>
                        
                        <p class="text-center text-muted mb-4">
                            Escribe el nombre que quieres guardar en la base de datos H2
                        </p>
                        
                        <form th:action="@{/insertar-h2}" method="post" class="needs-validation" novalidate>
                            <div class="mb-4">
                                <label for="nombreInput" class="form-label fw-bold">
                                    <i class="bi bi-pencil"></i> Nombre para guardar en H2:
                                </label>
                                <input type="text" 
                                       class="form-control input-pastel" 
                                       id="nombreInput"
                                       name="nombre"
                                       placeholder="Escribe aquí el nombre que quieres guardar..."
                                       required
                                       minlength="2"
                                       maxlength="100"
                                       autocomplete="off">
                                <div class="form-text">
                                    <i class="bi bi-info-circle"></i> Este nombre se guardará en la tabla <strong>REGISTROS</strong> de H2 Database con la fecha y hora actual
                                </div>
                                <div class="invalid-feedback">
                                    Por favor, escribe un nombre (mínimo 2 caracteres).
                                </div>
                            </div>
                            
                            <div class="text-center">
                                <button type="submit" class="btn btn-pastel-success btn-lg">
                                    <i class="bi bi-database-check"></i> Guardar en Base de Datos H2
                                </button>
                                <p class="text-muted mt-2 small">
                                    <i class="bi bi-clock"></i> Se agregará automáticamente la fecha y hora actual
                                </p>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Información de Base de Datos H2 -->
                    <div class="bd-info mb-4 text-center">
                        <h4><i class="bi bi-database-fill"></i> Base de Datos H2</h4>
                        <p class="mb-2">
                            <span class="counter-badge">
                                <i class="bi bi-list-ol"></i> 
                                Registros en H2: <strong th:text="${totalRegistrosH2}">0</strong>
                            </span>
                        </p>
                        <p class="mb-0">
                            Tabla: <strong>REGISTROS</strong> | 
                            Columnas: <strong>ID</strong> (auto), <strong>FECHA_REGISTRO</strong>, <strong>NOMBRE</strong>
                        </p>
                    </div>
                    
                    <!-- Botones de Acción -->
                    <div class="row mb-4">
                        <div class="col-md-4 mb-3">
                            <a href="/ver-registros-h2" class="btn btn-pastel-info btn-lg w-100">
                                <i class="bi bi-eye"></i> Ver Registros H2
                            </a>
                            <p class="text-muted mt-2 small text-center">
                                Ver tabla completa de H2
                            </p>
                        </div>
                        <div class="col-md-4 mb-3">
                            <a href="/principal" class="btn btn-pastel-primary btn-lg w-100">
                                <i class="bi bi-table"></i> Tabla en Memoria
                            </a>
                            <p class="text-muted mt-2 small text-center">
                                Personas (no en BD)
                            </p>
                        </div>
                        <div class="col-md-4 mb-3">
                            <a href="/registrar" class="btn btn-pastel-primary btn-lg w-100">
                                <i class="bi bi-person-plus"></i> Registrar Persona
                            </a>
                            <p class="text-muted mt-2 small text-center">
                                Formulario completo
                            </p>
                        </div>
                    </div>
                    <!-- Sección de Simulación de Errores -->
                    <div class="form-card mt-4" style="border-color: var(--pastel-red);">
                        <h3 class="text-center mb-4" style="color: var(--pastel-red);">
                            <i class="bi bi-bug"></i> Simulación de Errores
                        </h3>
                        
                        <p class="text-center text-muted mb-4">
                            Prueba las diferentes pantallas de error personalizadas
                        </p>
                        
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <a href="/error-404" class="btn btn-outline-danger w-100">
                                    <i class="bi bi-question-octagon"></i> Error 404
                                </a>
                                <p class="text-muted mt-1 small text-center">Página no encontrada</p>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <a href="/error-500" class="btn btn-outline-danger w-100">
                                    <i class="bi bi-exclamation-octagon"></i> Error 500
                                </a>
                                <p class="text-muted mt-1 small text-center">Error del servidor</p>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <a href="/error-validacion" class="btn btn-outline-warning w-100">
                                    <i class="bi bi-exclamation-triangle"></i> Error Validación
                                </a>
                                <p class="text-muted mt-1 small text-center">Parámetros inválidos</p>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <a href="/error-db" class="btn btn-outline-warning w-100">
                                    <i class="bi bi-database-x"></i> Error BD
                                </a>
                                <p class="text-muted mt-1 small text-center">Error de base de datos</p>
                            </div>
                        </div>
                        
                        <div class="text-center mt-3">
                            <button onclick="mostrarErrorPersonalizado()" class="btn btn-pastel-primary">
                                <i class="bi bi-lightning-charge"></i> Mostrar Error Modal
                            </button>
                            <p class="text-muted mt-2 small">
                                Muestra un error en un modal sin recargar la página
                            </p>
                        </div>
                    </div>
                    
                    <!-- Información de Memoria -->
                    <div class="demo-info">
                        <h5><i class="bi bi-memory"></i> Sistema en Memoria</h5>
                        <p class="mb-2">La funcionalidad principal del formulario trabaja con datos en memoria (no conectados a la base de datos).</p>
                        <p class="mb-0"><strong>Nota:</strong> Los datos en memoria se pierden al reiniciar la aplicación.</p>
                    </div>
                    
                    <!-- Acceso a Consola H2 -->
                    <div class="alert alert-light mt-4" role="alert">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-terminal fs-4 me-3" style="color: var(--pastel-purple);"></i>
                            <div>
                                <strong>Consola H2:</strong> Para acceder directamente a la base de datos H2, visita 
                                <a href="http://localhost:8080/h2-console" target="_blank" class="alert-link">http://localhost:8080/h2-console</a>
                                <br>
                                <small>
                                    <strong>Configuración:</strong> 
                                    URL: <code>jdbc:h2:mem:testdb</code> | 
                                    Usuario: <code>sa</code> | 
                                    Contraseña: (vacía)
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Características -->
                    <div class="row mt-5">
                        <div class="col-md-4 mb-4">
                            <div class="feature-icon mb-3 text-center">
                                <i class="bi bi-keyboard"></i>
                            </div>
                            <h5 class="text-center">Entrada Manual</h5>
                            <p class="small text-muted text-center">Escribe nombres para guardar en H2</p>
                        </div>
                        <div class="col-md-4 mb-4">
                            <div class="feature-icon mb-3 text-center">
                                <i class="bi bi-database"></i>
                            </div>
                            <h5 class="text-center">Base de Datos H2</h5>
                            <p class="small text-muted text-center">Tabla REGISTROS con datos persistentes</p>
                        </div>
                        <div class="col-md-4 mb-4">
                            <div class="feature-icon mb-3 text-center">
                                <i class="bi bi-palette"></i>
                            </div>
                            <h5 class="text-center">Diseño Moderno</h5>
                            <p class="small text-muted text-center">Interfaz con colores pastel</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="mt-5 text-center">
            <div class="text-muted">
                <small>
                    <i class="bi bi-code-square"></i> 
                    Spring Boot MVC | 
                    <i class="bi bi-database"></i> 
                    H2 Database (Tabla REGISTROS) |
                    <i class="bi bi-clock"></i> 
                    <span th:text="${#dates.format(#dates.createNow(), 'dd/MM/yyyy HH:mm')}"></span>
                </small>
            </div>
        </footer>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Marcar enlace activo en la navegación
        document.addEventListener('DOMContentLoaded', function() {
            const currentUrl = window.location.pathname;
            const navLinks = document.querySelectorAll('.nav-link');
            
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === currentUrl) {
                    link.classList.add('active');
                }
            });
            
            // Validación de formulario
            const form = document.querySelector('form[th\\:action="@{/insertar-h2}"]');
            if (form) {
                form.addEventListener('submit', function(event) {
                    if (!form.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    
                    form.classList.add('was-validated');
                    
                    // Animación del botón
                    const button = this.querySelector('button[type="submit"]');
                    const input = this.querySelector('input[name="nombre"]');
                    
                    if (form.checkValidity() && input.value.trim() !== '') {
                        const originalText = button.innerHTML;
                        button.innerHTML = '<i class="bi bi-arrow-clockwise fa-spin"></i> Guardando en H2...';
                        button.disabled = true;
                        
                        setTimeout(() => {
                            button.innerHTML = originalText;
                            button.disabled = false;
                        }, 2000);
                    }
                });
                
                // Enfocar el input automáticamente
                const nombreInput = document.getElementById('nombreInput');
                if (nombreInput) {
                    nombreInput.focus();
                    
                    // Limpiar placeholder al hacer clic
                    nombreInput.addEventListener('click', function() {
                        if (this.placeholder.includes('Escribe aquí')) {
                            this.placeholder = '';
                        }
                    });
                    
                    // Restaurar placeholder si está vacío
                    nombreInput.addEventListener('blur', function() {
                        if (this.value === '') {
                            this.placeholder = 'Escribe aquí el nombre que quieres guardar...';
                        }
                    });
                }
            }
            
            // Auto-ocultar alertas después de 5 segundos
            setTimeout(() => {
                document.querySelectorAll('.alert').forEach(alert => {
                    alert.style.transition = 'opacity 0.5s';
                    alert.style.opacity = '0';
                    setTimeout(() => alert.remove(), 500);
                });
            }, 5000);
        });
        
        // Tecla Enter para enviar formulario
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && document.activeElement.id === 'nombreInput') {
                const form = document.querySelector('form[th\\:action="@{/insertar-h2}"]');
                if (form && form.checkValidity()) {
                    const button = form.querySelector('button[type="submit"]');
                    if (button) button.click();
                }
            }
        });
    </script>
    <!-- Modal para Errores Personalizados -->
<div class="modal fade" id="errorModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-radius: 20px; overflow: hidden;">
            <div class="modal-header" style="background: linear-gradient(135deg, #ff6b6b, #ff8e53); color: white;">
                <h5 class="modal-title">
                    <i class="bi bi-exclamation-triangle"></i> Error Simulado
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-4">
                    <i class="bi bi-bug" style="font-size: 4rem; color: #ff6b6b;"></i>
                    <h4 class="mt-3" id="errorModalTitle">Error de Simulación</h4>
                    <p id="errorModalMessage">Este es un error simulado para demostrar el manejo de errores personalizado.</p>
                </div>
                
                <div class="alert alert-light">
                    <small>
                        <i class="bi bi-info-circle"></i>
                        Este error se muestra en un modal sin recargar la página.
                    </small>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i> Cerrar
                </button>
                <button type="button" class="btn btn-danger" onclick="simularErrorReal()">
                    <i class="bi bi-lightning"></i> Simular Error Real
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // Función para mostrar el modal de error
    function mostrarErrorPersonalizado() {
        const errores = [
            {
                titulo: "Error de Conexión",
                mensaje: "No se pudo establecer conexión con el servidor."
            },
            {
                titulo: "Tiempo de Espera Agotado",
                mensaje: "La operación tardó demasiado tiempo en completarse."
            },
            {
                titulo: "Recurso No Encontrado",
                mensaje: "El recurso solicitado no está disponible."
            },
            {
                titulo: "Permiso Denegado",
                mensaje: "No tienes permiso para realizar esta acción."
            }
        ];
        
        const error = errores[Math.floor(Math.random() * errores.length)];
        
        document.getElementById('errorModalTitle').textContent = error.titulo;
        document.getElementById('errorModalMessage').textContent = error.mensaje;
        
        const errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
        errorModal.show();
    }
    
    // Función para simular error real (llamada AJAX que falla)
    function simularErrorReal() {
        // Cerrar modal actual
        const errorModal = bootstrap.Modal.getInstance(document.getElementById('errorModal'));
        if (errorModal) errorModal.hide();
        
        // Mostrar carga
        const boton = event.target;
        const originalText = boton.innerHTML;
        boton.innerHTML = '<i class="bi bi-hourglass-split"></i> Simulando...';
        boton.disabled = true;
        
        // Intentar hacer una petición a un endpoint que no existe
        fetch('/endpoint-inexistente-' + Date.now())
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error HTTP: ' + response.status);
                }
                return response.text();
            })
            .catch(error => {
                // Mostrar error en un toast
                mostrarToastError(error.message);
            })
            .finally(() => {
                // Restaurar botón
                boton.innerHTML = originalText;
                boton.disabled = false;
            });
    }
    
    // Función para mostrar toast de error
    function mostrarToastError(mensaje) {
        // Crear toast
        const toastHtml = `
            <div class="toast align-items-center text-white bg-danger border-0" role="alert">
                <div class="d-flex">
                    <div class="toast-body">
                        <i class="bi bi-exclamation-triangle"></i> ${mensaje}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            </div>
        `;
        
        const toastContainer = document.getElementById('toastContainer') || crearToastContainer();
        toastContainer.innerHTML = toastHtml;
        
        const toast = new bootstrap.Toast(toastContainer.querySelector('.toast'));
        toast.show();
    }
    
    // Crear contenedor de toasts si no existe
    function crearToastContainer() {
        const container = document.createElement('div');
        container.id = 'toastContainer';
        container.className = 'position-fixed top-0 end-0 p-3';
        container.style.zIndex = '1060';
        document.body.appendChild(container);
        return container;
    }
    
    // Capturar errores globales de JavaScript
    window.addEventListener('error', function(event) {
        console.error('Error global capturado:', event.error);
        mostrarToastError('Error de JavaScript: ' + event.message);
    });
    
    // Capturar promesas no manejadas
    window.addEventListener('unhandledrejection', function(event) {
        console.error('Promesa no manejada:', event.reason);
        mostrarToastError('Error no manejado: ' + event.reason);
    });
</script>
</body>
</html>